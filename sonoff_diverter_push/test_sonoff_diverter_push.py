def test29_1_DIVERTER_GETJSON():
   import json, serial,time
   serialport = "/dev/cu.usbserial-A8007Zfw"
   #serialport = "/dev/cu.wchusbserial1410"

   ser = serial.Serial(serialport, 9600, timeout=0.3)
   s = ser.read(2000)
   print (s)
   toggle=True
   while True:
      #s=ser.read(2000)
      s=ser.read_until("\n",2000)
      if len(s)>0:print (len(s),repr(s))
      if len(s)>0 and s.startswith(b"DIVERTER_GETJSON"):
         #r='{"time_sec":%f}\n'%time.time()
         #r='{"triac2_request_state_01min": 0, "triac1_request_state": 0, "average_lost_power_7j_w": 6.52, "wrongVoltage": 0, "average_power_60min_w": -386.8, "Cycles50hz_ctr": 6297861, "triac2_request_state": 0, "average_excess_solar_power_01min_w": 81.04, "average_excess_solar_power_7j_w": 99.27, "average_power_02min_w": -94.5, "available_excess_solar_power_15min_w": 81.04, "AdcSamplingCtr": 193, "average_div_triac2_power_01min_w": 0.0, "average_lost_power_01min_w": 81.01, "IdleLoopCallsCtr": 48740, "average_div_triac1_power_01min_w": 0.0, "average_excess_solar_power_05min_w": 131.93, "energy_wh": 2525.4, "real_power_watt": -49.761, "average_excess_solar_power_02min_w": 94.48, "average_power_7j_w": 22.83, "average_power_05min_w": -131.91, "average_excess_solar_power_24h_w": 372.01, "solar_energie_wh": 12327.92, "wrongVoltage_app": 0, "triac1_request_state_01min": 0, "average_excess_solar_power_60min_w": 452.22, "triac2_diverted_energy_wh": 7298.7, "average_power_load_triac2_15min_w": 1912.13, "average_power_15min_w": -194.84, "triac1_non_diverted_energy_wh": 0.0, "average_excess_solar_power_15min_w": 202.35, "eeprom_save_ctr": 0, "average_power_24h_w": -7.13, "average_power_load_triac1_15min_w": 1915.74, "average_non_div_triac1_power_01min_w": 0.0, "uptime_ms": %d, "excess_solar_enery_wh": 12327.92, "average_lost_power_24h_w": 103.83, "wrongVoltage_ctr": 3, "average_power_01min_w": -81.01, "crc": 722994.12, "triac1_diverted_energy_wh": 2739.0, "log_date": "20210905T190110", "lost_energy_wh": 2291.6}\n' % int(time.time()*1000)
         #r='{"IdleLoopCallsCtr":16225,"uptime_ms":%d,"wrongVoltage":0,"wrongVoltage_app":0,"wrongVoltage_ctr":0,"AdcSamplingCtr":193,"real_power_watt":-149.533,"energy_wh":-2086.5,"lost_energy_wh":3008.5,"triac1_diverted_energy_wh":1223.2,"triac2_diverted_energy_wh":3659.9,"triac1_non_diverted_energy_wh":0.0,"Cycles50hz_ctr":1724105,"solar_energie_wh":7891.57,"excess_solar_enery_wh":7891.57,"average_power_01min_w":23.99,"average_power_02min_w":23.99,"average_power_05min_w":23.46,"average_power_15min_w":-33.01,"average_power_60min_w":-223.06,"average_power_24h_w":-122.17,"average_power_7j_w":-18.53,"average_lost_power_01min_w":0.00,"average_lost_power_24h_w":170.83,"average_lost_power_7j_w":5.33,"triac1_request_state":0,"triac2_request_state":0,"triac1_request_state_01min":0,"triac2_request_state_01min":0,"average_div_triac1_power_01min_w":0.00,"average_div_triac2_power_01min_w":0.00,"average_non_div_triac1_power_01min_w":0.00,"available_excess_solar_power_15min_w":0.00,"average_excess_solar_power_01min_w":0.00,"average_excess_solar_power_02min_w":0.00,"average_excess_solar_power_05min_w":6.05,"average_excess_solar_power_15min_w":60.82,"average_excess_solar_power_60min_w":289.62,"average_excess_solar_power_24h_w":384.68,"average_excess_solar_power_7j_w":69.54,"average_power_load_triac1_15min_w":1887.48,"average_power_load_triac2_15min_w":1877.38,"eeprom_save_ctr":0,"crc":397775.06}\n' % int(time.time()*1000)
         r=b'{"triac2_request_state_01min": 0, "triac1_request_state": 0, "average_lost_power_7j_w": 16.59, "wrongVoltage": 0, "average_power_60min_w": 48.3, "Cycles50hz_ctr": 69943086, "triac2_request_state": 0, "average_excess_solar_power_01min_w": 516.56, "average_excess_solar_power_7j_w": 198.32, "average_power_02min_w": 0.0, "available_excess_solar_power_15min_w": 445.39, "AdcSamplingCtr": 192, "average_div_triac2_power_01min_w": 0.0, "average_lost_power_01min_w": 0.0, "IdleLoopCallsCtr": 3924, "average_div_triac1_power_01min_w": 517.03, "average_excess_solar_power_05min_w": 495.47, "energy_wh": 66143.3, "real_power_watt": -474.372, "average_excess_solar_power_02min_w": 510.0, "average_power_7j_w": 246.04, "average_power_05min_w": -0.0, "average_excess_solar_power_24h_w": 244.37, "solar_energie_wh": 108450.11, "wrongVoltage_app": 0, "triac1_request_state_01min": 0, "average_excess_solar_power_60min_w": 742.87, "triac2_diverted_energy_wh": 57164.1, "average_power_load_triac2_15min_w": 1888.01, "average_power_15min_w": 0.32, "triac1_non_diverted_energy_wh": 0.0, "average_excess_solar_power_15min_w": 487.86, "eeprom_save_ctr": 0, "average_power_24h_w": 191.08, "average_power_load_triac1_15min_w": 1835.89, "average_non_div_triac1_power_01min_w": 0.0, "uptime_ms": %d, "excess_solar_enery_wh": 108450.11, "average_lost_power_24h_w": 1.1, "wrongVoltage_ctr": 1, "average_power_01min_w": 0.0, "crc": 190685.45, "triac1_diverted_energy_wh": 33414.7, "lost_energy_wh": 17874.8}\n'% int(time.time()*1000)
         print (r)
         #ser.write('{"triac2_request_state_01min": 0, "triac1_request_state": 0, "average_lost_power_7j_w": 0.2, "wrongVoltage": 0, "average_power_60min_w": 1617.88, "Cycles50hz_ctr": 87607784, "triac2_request_state": 0, "average_excess_solar_power_01min_w": 326.72, "average_excess_solar_power_7j_w": 112.14, "average_power_02min_w": 5.63, "available_excess_solar_power_15min_w": 107.16, "AdcSamplingCtr": 193, "average_div_triac2_power_01min_w": 0.0, "average_lost_power_01min_w": 0.0, "IdleLoopCallsCtr": 61118, "average_div_triac1_power_01min_w": 326.72, "average_excess_solar_power_05min_w": 221.72, "energy_wh": 867389.8, "real_power_watt": -343.326, "average_excess_solar_power_02min_w": 339.73, "average_power_7j_w": 1858.4, "average_power_05min_w": 1042.82, "average_excess_solar_power_24h_w": 50.15, "solar_energie_wh": 57319.46, "wrongVoltage_app": 0, "triac1_request_state_01min": 0, "average_excess_solar_power_60min_w": 100.01, "triac2_diverted_energy_wh": 5995.9, "average_power_load_triac2_15min_w": 1841.41, "average_power_15min_w": 1675.99, "triac1_non_diverted_energy_wh": 142484.4, "average_excess_solar_power_15min_w": 115.5, "eeprom_save_ctr": 0, "average_power_24h_w": 1917.57, "average_power_load_triac1_15min_w": 1813.27, "average_non_div_triac1_power_01min_w": 0.0, "uptime_ms": 1757690275, "excess_solar_enery_wh": 57319.46, "average_lost_power_24h_w": 0.05, "wrongVoltage_ctr": 11, "average_power_01min_w": 0.0, "crc": 554247.87, "triac1_diverted_energy_wh": 51257.9, "log_date": "20210110T150020", "lost_energy_wh": 70.5}')
         ser.write(r)
   ser.close()

test29_1_DIVERTER_GETJSON()
